<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="search">
	<select id="searchList" resultType="search">
       select
			ow_store_name as owStoreName, 
		    substr(ow_store_addr,1,2) as owStoreAddrFirst,
		    substr(ow_store_addr,instr(ow_store_addr,' ')+1,instr(ow_store_addr,'구')-instr(ow_store_addr,' ')) as owStoreAddrFinal,
		    ow_photo_route as owPhotoRoute,
		    store_cate_detail_name as storeCateDetailName,
		    ow_store_comment as owStoreComment
        from (
        select * from 
        owner_store_info_tb info, 
        owner_store_photo_tb photo, store_category_detail_tb cate, owner_store_detail_tb detail
        where photo.ow_store_info_fk = info.ow_store_info_pk
		and info.ow_store_detail_type_fk = cate.store_cate_detail_pk
		and info.ow_store_info_pk = detail.ow_store_index)
		where ow_store_info_fk between #{start} and #{end}
		order by ow_store_info_pk
	</select>
	
	<select id="searchCount" parameterType="search" resultType="int"> 
		select count(*) from owner_store_info_tb
	</select>
	
	<select id="detailPage" resultType="search">
		select 
		    ow_store_name as owStoreName, 
		    substr(ow_store_addr,1,2) as owStoreAddrFirst,
		    substr(ow_store_addr,instr(ow_store_addr,' ')+1,instr(ow_store_addr,'구')-instr(ow_store_addr,' ')) as owStoreAddrFinal,
		    ow_photo_route as owPhotoRoute,
		    store_cate_detail_name as storeCateDetailName,
		    ow_store_comment as owStoreComment,
		    ow_store_head_photo as owStoreHeadPhoto
		from owner_store_info_tb info, owner_store_photo_tb photo, store_category_detail_tb cate, owner_store_detail_tb detail
		where photo.ow_store_info_fk = info.ow_store_info_pk
		and info.ow_store_detail_type_fk = cate.store_cate_detail_pk
		and info.ow_store_info_pk = detail.ow_store_index
		and ow_store_name = #{owStoreName}
	</select>
	
	
</mapper>